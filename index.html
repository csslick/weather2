<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ajax weather</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div id="page">
    <h1>Simple Weather App</h1>
    <figure>
      <div class="center">
        <img class="icon" src="" alt="icon">
        <p><i class="fas fa-spinner fa-spin"></i></p>
        <figcaption>
          <ul>
            <li class="summary"></li>
            <li class="temp"></li>
            <li class="area"></li>
          </ul>
        </div>
      </figcaption>
    </figure>

    <select name="area" id="area">
      <option value="37.559326,126.97853337">위치 선택</option>
      <option value="37.559326,126.97853337">서울</option>
      <option value="37.456244,126.705916">인천</option>
      <option value="36.350684,127.384727">대전</option>
      <option value="35.871434,128.601675">대구</option>
      <option value="35.179774,129.074976">부산</option>
      <option value="33.499609,126.531265">제주도</option>
    </select>

  </div><!-- end page -->

<script>

  var url ='https://api.darksky.net/forecast/ce0b572bee660ab58fa8396665d3d088/';
  var latlon = "37.559326,126.97853337";
  var new_url = url + latlon;

  function getWeather(){
      $.getJSON(new_url + "?callback=?", function(data) {

          var temp = parseInt((data.currently.temperature - 32) / 1.8);
          var icon_name = '';  // 아이콘 이미지명

          switch (data.currently.icon) {
            case "clear-day": icon_name = "fair"; bg= "#f26549";
                  $('.icon').show();
                  break;
            case "clear-night": icon_name = "sunny_night"; bg="#85679b";
                  $('.icon').show()
                  break;
            case "rain": icon_name = "rain"; bg="#b4a699";
                  $('.icon').show()
                  break;
            case "snow": icon_name = "snow"; bg="#8d9c9f";
                  $('.icon').show()
                  break;
            case "sleet": icon_name = "snow"; bg="#8d9c9f";
                  $('.icon').show()
                  break;
            case "fog": icon_name = "cloudy"; bg="#8d9c9f";
                  $('.icon').show()
                  break;
            case "cloudy": icon_name = "cloudy"; bg="#8d9c9f";
                  $('.icon').show()
                  break;
            case "partly-cloudy-day": icon_name = "sun_cloudy"; bg="#d870a5";
                  $('.icon').show()
                  break;
            case "partly-cloudy-night": icon_name = "fog_night.png"; bg="#85679b";
                  $('.icon').show()
                  break;
            default: $('.icon').hide(); break;
          }

          $('.area').text(data.timezone);
          $('.summary').text(data.currently.summary);
          $('.icon').attr('src', 'images/' + icon_name + '.png');
          $('.temp').html(temp + '&deg;');
          $('#page').css('background', bg);
      }).done(function(){
          $('.fa-spinner').hide();
      })
  }

  // 현재 내 지도 위치값 가져오기
  function getLocation() {
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(pos){
            // console.log(pos.coords.latitude + ',' + pos.coords.longitude);
            latlon = pos.coords.latitude + ',' + pos.coords.longitude;
          });
      } else {
        alert("디바이스 또는 브라우저가 위치 정보 기능을 지원하지 않습니다.");
      }
  }

  getLocation();  // 현재 내 지도 위치(기본값)
  getWeather();   //

  // 위치 정보 입력
  $('#area').on('change', function(){
    var i = $(this).prop('selectedIndex');
    latlon = $(this).val();
    new_url = url + latlon;
    getWeather();

    $('.area').html($(this).find('option').eq(i).text());
    console.log($(this).find('option').eq(i).text());
  });




</script>

<!-- <script src='https://api.darksky.net/forecast/ce0b572bee660ab58fa8396665d3d088/37.559326,126.978533?callback=json_cb'></script> -->
</body>
</html>
